---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allWorks = await getCollection('works');
const authorMap = new Map();

// Group works by author
allWorks.forEach(work => {
  work.data.author.forEach(author => {
    if (!authorMap.has(author)) {
      authorMap.set(author, []);
    }
    authorMap.get(author).push(work);
  });
});

// Sort authors alphabetically
const authors = Array.from(authorMap.entries())
  .map(([name, works]) => ({ name, works, count: works.length }))
  .sort((a, b) => a.name.localeCompare(b.name));
---

<BaseLayout title="Authors - Dhwani">
  <main>
    <!-- Page Header -->
    <section class="py-12 md:py-16 lg:py-24 px-6 md:px-8 lg:px-12 max-w-[1100px] mx-auto">
      <h1 class="font-serif text-[clamp(2.5rem,7vw,5.5rem)] font-semibold leading-[1.1] tracking-[-0.02em] text-ink mb-6 md:mb-8">
        Authors
      </h1>

      <p class="font-serif-body text-base md:text-[1.3rem] leading-[1.7] md:leading-[1.9] text-ink-medium font-light">
        Browse works by {authors.length} authors who have shaped Indian literary tradition.
      </p>
    </section>

    <!-- Authors List -->
    <section class="pb-16 md:pb-24 lg:pb-32 px-6 md:px-8 lg:px-12">
      <div class="max-w-[1100px] mx-auto">
        <div class="space-y-0">
          {authors.map(({ name, count, works }) => (
            <div class="py-8 md:py-10 border-b border-line-light first:pt-0">
              <h2 class="font-serif text-[1.5rem] md:text-[1.75rem] font-semibold tracking-tight text-ink mb-3">
                {name}
              </h2>

              <div class="text-[0.85rem] uppercase tracking-[0.08em] text-ink-lighter mb-5">
                {count} {count === 1 ? 'Work' : 'Works'}
              </div>

              <div class="space-y-3">
                {works.slice(0, 3).map(work => (
                  <a href={`/works/${work.slug}`} class="block">
                    <div class="text-[0.95rem] md:text-[1.05rem] text-accent font-light">
                      {work.data.title}
                    </div>
                  </a>
                ))}
                {count > 3 && (
                  <div class="text-[0.85rem] text-ink-lighter font-light">
                    + {count - 3} more
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
